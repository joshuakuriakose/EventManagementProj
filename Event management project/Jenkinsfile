pipeline {
    agent { label 'DESKTOP-PNDAH72' }

    environment {
        XAMPP_HTDOCS = 'C:\\xampp\\htdocs\\EventProject'  // Your destination directory
        PROJECT_SOURCE = "${WORKSPACE}"  // Source: Jenkins workspace
    }

    stages {
        stage('Checkout SCM') {
            steps {
                echo 'üì• Checking out source code from Git...'
                checkout scm
            }
        }

        stage('Start Apache Server') {
            steps {
                echo 'üöÄ Starting Apache Server if not already running...'
                bat '''
                tasklist /FI "IMAGENAME eq httpd.exe" | find /I "httpd.exe"
                if errorlevel 1 (
                    echo Apache not running. Starting now...
                    start "" "C:\\xampp\\apache\\bin\\httpd.exe"
                    timeout /T 5
                ) else (
                    echo Apache is already running.
                )
                '''
            }
        }

        stage('PHP Lint Check') {
            steps {
                echo 'üîç Running PHP lint check on project files...'
                bat '''
                for %%f in (%PROJECT_SOURCE%\\*.php) do php -l "%%f"
                '''
            }
        }

        stage('Deploy to XAMPP') {
            steps {
                echo 'üìÇ Deploying website to XAMPP htdocs...'
                bat '''
                if not exist "%XAMPP_HTDOCS%" mkdir "%XAMPP_HTDOCS%"
                xcopy /Y /E /I "%PROJECT_SOURCE%\\*" "%XAMPP_HTDOCS%\\"
                '''
            }
        }

        stage('Open Website in Browser') {
            steps {
                echo 'üåê Opening website in default browser...'
                bat 'start http://localhost/EventProject'
            }
        }
    }

    post {
        always {
            echo '‚úîÔ∏è Pipeline execution complete.'
        }
        success {
            echo '‚úÖ Build completed successfully!'
        }
        failure {
            echo '‚ùå Build failed!'
        }
    }
}
